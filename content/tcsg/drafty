
### Requerimientos  

En este caso, vamos a usar *GPG* para protegerlos, si no tienes `gpg` instalada en tu Mac, la puedes instalar con `
brew install gpg`.

Una contrase帽a (vamos a llamarla `DECRYPT_KEY`) para encriptar archivos mediante *gpg*, te recomiendo que sea generada autom谩ticamente. Gen茅rala y tenla a la mano porque la vamos a utilizar unas cuantas veces en este post.

### Obteniendo un certificado de publicaci贸n para iOS
Te recomiendo generar un certificado de publicaci贸n para cada app que desarrolles, aunque, este certificado lo puedes compartir entre varias, puesto que este certificado te identifica a ti como quien publica la app. En este caso, ser谩 el servidor de GitHub el que publique y al que tu le estar谩s dando permiso de autenticarse como tu.

Para generar un certificado nuevo, visita https://developer.apple.com/account/resources/certificates/list, elige "Crear un nuevo certificado" y selecciona "Apple Distribution":

![Imgur](https://imgur.com/b6T6YYw.png)
Una vez creado, descarga el certificado e inst谩lalo en tu computadora. Para instalarlo simplemente da doble click en el archivo que acabas de descargar.

![Imgur](https://i.imgur.com/XXThK37.png)
El siguiente paso es crear y descargar un perfil de publicaci贸n para tu app:

![Imgur](https://i.imgur.com/6CodfmN.png)
Elige "Distribution" y "App Store":

![Imgur](https://i.imgur.com/TbrqVrY.png)
Elige despu茅s el identificador de tu aplicaci贸n:

![Imgur](https://i.imgur.com/0eCLTi0.png)
Asegurate tambi茅n que elijas el certificado adecuado, justamente el que creamos en el paso anterior.

![Imgur](https://i.imgur.com/pIKkXbl.png)
Establece un nombre descriptivo, y genera el perfil de publicaci贸n.

![Imgur](https://i.imgur.com/peJlpOZ.png)
Siguiente paso es descargar y abrir el perfil de publicaci贸n, si Xcode no est谩 abierto, el abrir el perfilde publicaci贸n lo abrir谩. Una vez hecho esto, podemos configurar nuestra app para usarlos al momento de crear el archivo que vamos a publicar en la app store.

## Configura tu app para usar los certificados

El siguiente paso es configurar tu aplicaci贸n de Xamarin.iOS (o tu aplicaci贸n de iOS normal), la opci贸n a elegir en Xamarin es "iOS Bundle Signing", asegurate de que en la Configuraci贸n est茅 seleccionada la opci贸n `Release` y de que como plataforma est茅 elegida `iPhone`. Luego entonces selecciona el certificado y el perfil de aprovisionamiento que acabamos de crear.

![Imgur](https://i.imgur.com/zJGWRBu.png)


## Colocando los certificados en GitHub
 > ㄢ锔 隆Mucho cuidado! 隆aseg煤rate de no subir ninguno de los siguientes archivos a menos de que est茅n encriptados! 锔

### Exportando el certificado  

![Imgur](https://i.imgur.com/G0pF2C0.png)
![Imgur](https://i.imgur.com/hByhz7g.png)
Guarda el archivo con el nombre `Certificates.p12` dentro de la carpeta `secrets`.

![Imgur](https://i.imgur.com/5gT22K6.png)
### Exportando los perfiles de publicaci贸n 

Lo primero es descubrir cu谩l es el perfil de publicaci贸n que corresponde al que acabamos de descargar, para hacerlo, lista los perfiles con el siguiente comando:
```
ls -lah ~/Library/MobileDevice/Provisioning\ Profiles/
```

En este caso, el m谩s reciente es el que corresponde al perfil de publicaci贸n de nuestra app, tiene el identificador `f3b9e904-6d99-409a-91f4-440c5b79565d`:

![Imgur](https://i.imgur.com/9cEkq9v.png)
El siguiente paso es copiar el perfil a la carpeta `secrets`. 

```
cp ~/Library/MobileDevice/Provisioning\ Profiles/f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision secrets
```
Toma nota de este identificador porque lo ver谩s en muchos lados, el m铆o es `f3b9e904-6d99-409a-91f4-440c5b79565d` pero el tuyo sera diferente.

### Encriptando nuestros secretos  

Como lo mencion茅 al inicio de esta secci贸n, no podemos subir nuestros secretos (l茅ase el certificado y el perfil de publciaci贸n) as铆 como as铆 a GitHub, antes hay que protegerlos mediante la encriptaci贸n. Usaremos *gpg* y la contrase帽a que creaste al inicio de este post.

```
gpg --symmetric --cipher-algo AES256 Certificates.p12
```

```
gpg --symmetric --cipher-algo AES256 f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision
```

```
Certificates.p12.gpg
f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision.gpg
```


```
rm Certificates.p12
rm f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision
```

### Desencriptando el acertificado en GitHub

 - Desencriptar los secretos usando el password almacenado en "DECRYPT_KEY"
 
```bash
gpg --quiet --batch --yes --decrypt --passphrase="$DECRYPT_KEY" --output ./secrets/f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision ./secrets/f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision.gpg
gpg --quiet --batch --yes --decrypt --passphrase="$DECRYPT_KEY" --output ./secrets/Certificates.p12 ./secrets/Certificates.p12.gpg
```

```bash
## Crea la carpeta "Provisioning Profiles" en esta computadora
mkdir -p ~/Library/MobileDevice/Provisioning\ Profiles
```

## Copia el perfil de publicaci贸n a la carpeta reci茅n creada
cp ./secrets/f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision ~/Library/MobileDevice/Provisioning\ Profiles/f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision

## Crea un Keychain e importa el archivo Certificates.p12
security create-keychain -p "" build.keychain
security import ./secrets/Certificates.p12 -t agg -k ~/Library/Keychains/build.keychain -P "" -A

## Establece el Keychain recien creado como default
security list-keychains -s ~/Library/Keychains/build.keychain
security default-keychain -s ~/Library/Keychains/build.keychain
security unlock-keychain -p "" ~/Library/Keychains/build.keychain
security set-key-partition-list -S apple-tool:,apple: -s -k "" ~/Library/Keychains/build.keychain
```

Todas las instrucciones anteriores debemos colocarlas en un archivo llamado `decrypt_secrets.sh` dentro de nuestra carpeta `secrets`, no te olvides de darle permisos de ejecuci贸n a este archivo mediante el siguiente comando:

```
chmod +x secrets/decrypt_secrets.sh
```

# Configurando GitHub
